<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Test-first F# with Acceptance tests and the REPL</title>

  <meta name="author" content="Matt Ball" />
  
  

  <meta name="generator" content="Hugo 0.15" />

  <link rel="alternate" href="http://mattdrivendev.github.io/index.xml" type="application/rss+xml" title="strongly-typed">

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://mattdrivendev.github.io/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://mattdrivendev.github.io/css/main.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://mattdrivendev.github.io/css/pygment_highlights.css" />
  
  
  <meta property="og:title" content="Test-first F# with Acceptance tests and the REPL" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/" />
  <meta property="og:image" content="" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://mattdrivendev.github.io/">strongly-typed</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
	  </div>
	</div>

  </div>
</nav>


    <div role="main" class="container main-content">

      
        





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Test-first F# with Acceptance tests and the REPL</h1>
      
      
      
      <span class="post-meta">Posted on October 15, 2013</span>
      
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
          

<p>Lunchtime blogging strikes again - this post has probably been brought to you over the course of a few lunch times.</p>

<p>Like most of my posts on the subject of <code>F#</code> there really isn&rsquo;t much I&rsquo;m adding to the wealth of the community, but I feel as if contributing to the community in blog posts from an <em>average .NET developer&rsquo;s</em> perspective does have value. F# is pegged and marketed as a great language for niche problem domains (just look at the <a href="http://www.tryfsharp.org/Learn">Try F#: Learn page</a>) - but I&rsquo;m all about using F# as a great general purpose language, instead of C# or VB.NET.</p>

<p>This post is probably a long time coming since I&rsquo;m really enthusiastic about both <em>test-first</em> software development and F#. I&rsquo;ve been mostly prompted to write my thoughts and findings down in response to seeing <a href="https://twitter.com/RobAshton">RobAston</a>&rsquo;s blog post - <a href="http://codeofrob.com/entries/on-testing-and-the-repl-in-clojure.html">On testing and the REPL in Clojure</a>; who I&rsquo;ve been following (which as I can see from Twitter, most of the developer community does!) while he adopts <a href="http://clojure.org/">Clojure</a>.</p>

<p>So what am I going to be writing about? Basically how using F# makes it easy for me to drop some of the dogma and get on with it. I&rsquo;ve done a few projects now at work which involved writing F#, and this kind of outlines the <em>how I work</em> while doing it.</p>

<h2 id="1-requirements:7a030898070f84c64c2d6892be780dc1">1. Requirements</h2>

<p>I&rsquo;ll skim over this, because it really should be a no-brainer. Like most good tests it all tends to start with a requirement - verbal, written, whatever; which we&rsquo;re going to boil down condense into some executable form.</p>

<h2 id="2-outside-in:7a030898070f84c64c2d6892be780dc1">2. Outside-in</h2>

<p>I almost exclusively work outside-in, for a multitude of reasons that are explained at great length elsewhere. Go Google it.</p>

<p>So my main tests are going to be running from the outside, based on requirements. Acceptance tests I guess.</p>

<h2 id="3-tests:7a030898070f84c64c2d6892be780dc1">3. Tests!</h2>

<p><em>Read as: executable requirements documents</em>.</p>

<p>I&rsquo;ve toyed with fluent libraries, Gherkin (Cucumber/SpecFlow), building my own <em>readable</em> API in my test harness and more recently - just using F# with the double-back-tick syntax. The key here is that I&rsquo;m directly creating tests that are mapped to requirements - using real examples, stuff that other people can understand (not necessarily the stakeholders, but just other team members is a great start); hopefully the aim is to create tests that simply describe expected <strong>behaviours</strong>.</p>

<p>You&rsquo;re thinking about the problem. Thinking about how you&rsquo;re going to know that you&rsquo;ve solved the problem correctly - without actually thinking about solving the problem&hellip; if you follow me. The, <em>thinking about how you&rsquo;re going to know that you&rsquo;ve solved the problem correctly</em> is a key part - which is how you&rsquo;re going to make the code easily testable. Some requirements have less obvious answers, answers that perhaps are only visible in downstream systems etc (end-to-end systems/integration testing anyone?) - this is often a sign where you should put some good logging that can tell people who care, what the system is doing.</p>

<h2 id="4-api:7a030898070f84c64c2d6892be780dc1">4. API</h2>

<p>Chances are at this point I&rsquo;ll need some new things to talk to from my test code. Interfaces/Schemas/Contracts/API - whatever. Something that I can call from the outside world (outside-in remember) - passing in everything that it needs to know.</p>

<h2 id="5-make-it-green:7a030898070f84c64c2d6892be780dc1">5. Make it green</h2>

<p>Making the first test pass is often the longest part. There is often a large body of <em>stuff</em> that needs to be built up, just to get that <em>skeleton</em> of an application in place.</p>

<p>Sometimes the solutions present themselves very easily, it&rsquo;s a known problem with well suited known methods to solve them. No brainers. At this stage I wouldn&rsquo;t get too caught up with creating smaller tests to explore how the implementation of the solution will fit together. I would just invest the time in solving the problem how I know best - any tests you create at this point would be expensive to maintain, brittle and essentially you should just end up deleting them later anyway.</p>

<p>But what happens when I don&rsquo;t know what to do. It doesn&rsquo;t necessarily need to be a problem that isn&rsquo;t solved by the community at large - but a problem that you (and your team) haven&rsquo;t encountered before (probably some weird business process/logic that you&rsquo;re automating). In a stricter TDD world I&rsquo;d be guided by tests here - fleshing out little parts from the outside-inwards with test cases discovering and designing the internals of the application. Until such a time, that you hopefully - make the first real test that matters, pass (and go green). Some folks call this <em>changing down gears</em>.</p>

<p>But with F# you have other options&hellip;</p>

<h3 id="5-make-it-green-with-added-repl:7a030898070f84c64c2d6892be780dc1">5. &hellip;make it green, with added REPL!</h3>

<p>I&rsquo;m not experienced enough with functional programming to simply <em>know</em> the solution yet, I&rsquo;m sure with time this might come. I&rsquo;m starting to recognise a few patterns, and a few ideas like <em>choice types</em> and <em>map/reduce</em> can solve a huge number of things, as I&rsquo;ve seen. But I&rsquo;m equally sure that even when I do feel as if I <em>know</em> the solutions - I won&rsquo;t change the way that I work&hellip; which is essentially to live in the REPL.</p>

<p>In the land of <code>F#</code> we&rsquo;re using the F# Interactive as our REPL - embedded in an IDE like Visual Studio, Xamarin Studio, Emacs, Sublime Text etc; or just running it from the command line (<code>fsi</code>, or <code>fsharpi</code> in the Mono world). I&rsquo;ll either be feeling my way through in a F# script file (<code>.fsx</code> files), or any other source file and using whatever <em>send to interactive/repl</em> commands I have available - and less frequently, even just directly in the REPL itself.</p>

<p>With this tool it is very easily to discover the solution, building one small function at a time - and then composing them together, or just using them as part of other functions.</p>

<p>The great thing here, particularly with a functional language like F# - is that working in this way kind of forces you to write code that is both pure and testable:</p>

<ul>
<li>Stateless</li>
<li>Free from side effects</li>
<li>Values in - values out</li>
</ul>

<p>An added benefit of a functional codebase is that in order to test your functions - you&rsquo;re not having to jump through hoops building up some kind of objects with <em>setup</em> and <em>teardown</em> test hooks. Test cases become little more than values and expected values.</p>

<p>The key here is that running code in the REPL is fast. This makes it really cheap.</p>

<p>Once you discover that solution, and you&rsquo;re happy with the results - just cut &amp; paste that code straight into your production source code. Job done.</p>

<p>I don&rsquo;t tend to keep that code in a script file, or even move it to a smaller test elsewhere. If I&rsquo;ve <a href="http://fsharpforfunandprofit.com/category/DDD/">designed my types properly</a> I really don&rsquo;t need to. <em>But if I did want to keep</em> those test cases (remember, they&rsquo;re just values) - I&rsquo;d keep them in a <code>test.fsx</code> file in the project, which isn&rsquo;t compiled into the application code anyway - and they&rsquo;re certainly not key for the build/test run to complete properly (which means that they are zero cost to maintain, if you don&rsquo;t want to).</p>

<p>So the REPL really is just a form of test-first development - but one that lets me go faster than building up unit tests.</p>

<h2 id="6-refactoring:7a030898070f84c64c2d6892be780dc1">6. Refactoring</h2>

<p>There should be some hard fast rules to refactoring:</p>

<ul>
<li>Don&rsquo;t over-engineer.</li>
<li>Refactor away only the pain-points.</li>
<li>Reduce LOC (maintenance overhead).</li>
</ul>

<p>Point one there is the most important to me - I&rsquo;ve picked up a few codebases in my time where the amount of abstraction far outweighs any benefit to the value of the system, and any perceived extensibility etc.</p>

<p>Sometimes you should really <strong>Keep it <del>Simple</del> Slayer Stupid</strong>.</p>

<p>Whilst F# currently lacks some really smart tooling for refactoring in fun automated ways (though I am pretty sure some people are some great work in that space) - we again have the REPL!</p>

<p>You&rsquo;ll have your top-level acceptance tests to lean on to ensure no regression - but you can feel your way to a more elegant, less expensive way of expressing your solution in a REPL environment. Again, as you&rsquo;re happy with the results - just replace existing code in the production codebase with the new bits.</p>

<p>Simple as that.</p>

<h2 id="7-write-another-test-watch-it-fail:7a030898070f84c64c2d6892be780dc1">7. Write another test, watch it fail&hellip;</h2>

<p>Uh-oh! I&rsquo;ve broken the process.</p>

<p>Sometimes I&rsquo;ve noticed that I often write another test (or rather, another concrete example that leans on a certain requirement) - and it passes first time. Don&rsquo;t worry - this is perfectly normal. I used to distrust it and would do a little stepping through the code in the debugger. But it always proved to be a fruitless waste of time. Logging has replaced that (with good logs being written, you can quickly skim over those).</p>

<p>So that saves some time, right?</p>

<p>But why did it happen? Probably because of the F# type system. The compiler is a hard task master, and tends to like to make you <strong>think</strong> quite hard about the solution up-front. It doesn&rsquo;t like you leaving <em>i&rsquo;s</em> un-dotted, and <em>t&rsquo;s</em> un-crossed. You aren&rsquo;t writing statements that just <em>do things</em> (like modifying internal state) - you&rsquo;re writing expressions - and the types of those expressions need to all tie up nicely.</p>

<p>The downside is that it normally takes a whole bunch of time to get things compiled - but funnily enough; when they do, they almost always work first time (and stay working).</p>

<p>Hopefully you&rsquo;re not too adversed to <em>thinking</em> and <strong>not</strong> taking <em>shortcuts</em>&hellip;</p>

<h2 id="f-go-faster-stripes:7a030898070f84c64c2d6892be780dc1">F# go-faster stripes</h2>

<p>So hopefully I&rsquo;ve documented my process well enough to convey my thoughts on it - but just in case; here are some bullet points:</p>

<ul>
<li>Functional programming (F#) using a REPL (F# Interactive) lets me drop the dogma.</li>
<li>Dropping the dogma lets me go faster.</li>
<li>The type system lets me stop making silly mistakes and helps solve more problems, more quickly.</li>
</ul>

      </article>

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="http://mattdrivendev.github.io/post/adopting-fsharp-03/" data-toggle="tooltip" data-placement="top" title="Adopting F#, part 3">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="http://mattdrivendev.github.io/post/10-things-i-learned-from-my-first-hackathon/" data-toggle="tooltip" data-placement="top" title="10 things I learned from my first hackathon">Next Post &rarr;</a>
        </li>
        
      </ul>

      

    </div>
  </div>
</div>

      

    </div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/MattDrivenDev" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="https://twitter.com/MattDrivenDev" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
		      
          <li>
            <a href="https://uk.linkedin.com/in/matt-ball-98120940" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	    	  
          
          

    		  <li>
      			<a href="http://mattdrivendev.github.io/index.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="copyright text-muted">
    		  Matt Ball
    		  &nbsp;&bull;&nbsp;
    		  2016
    		  
    		  
    		  &nbsp;&bull;&nbsp;
    		  <a href="http://mattdrivendev.github.io/">strongly-typed</a>
    		  
  	    </p>
  	        
    		<p class="theme-by text-muted">
    		  Theme by
    		  <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
    		</p>
      </div>
    </div>
  </div>
</footer>

<script src="http://mattdrivendev.github.io/js/jquery-1.11.2.min.js"></script>
<script src="http://mattdrivendev.github.io/js/bootstrap.min.js"></script>
<script src="http://mattdrivendev.github.io/js/main.js"></script>



  </body>
</html>
